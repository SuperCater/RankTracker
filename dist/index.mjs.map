{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import axios from 'axios'\nimport roles from './types/roles'\nimport Data from './types/data'\nimport diffData from './types/diffData'\nimport fs from 'fs'\n\nconst get = async (url: string) => {\n\ttry {\n\t\treturn await axios.get(url).then(res => res.data)\n\t} catch (e) {\n\t\tconsole.log(e)\n\t\treturn null\n\t}\n}\n\nexport type RankTrackerType = {\n\tindex: (groupID: string, options?: Object) => Promise<Data | null>;\n\tdiff: (first: Data, second: Data, options?: Object) => Promise<diffData>;\n}\n\nconst groupURL = \"https://groups.roblox.com/v1/groups/\"\n\nconst RankTracker: RankTrackerType = {\n\tindex: async (groupID: string, options?: Object) => {\n\t\tlet group\n\t\ttry {\n\t\t\tgroup = await get(groupURL + groupID)\n\t\t} catch (e) {\n\t\t\tconsole.log(e)\n\t\t\treturn null\n\t\t}\n\t\t// Get the group roles\n\t\tconst roles : roles = await get(groupURL + groupID + \"/roles\")\n\t\tlet data : Data = {\n\t\t\tname: group.name,\n\t\t\tid: group.id,\n\t\t\tranks: [15, 25, 30, 32, 35, 45, 50], // Set this to the ranks to track\n\t\t\troles: []\n\t\t}\n\t\tfor (const role of roles.roles) {\n\t\t\tif (!data.ranks.includes(role.rank)) continue\n\t\t\tdata.roles.push({\n\t\t\t\tid: role.id,\n\t\t\t\tname: role.name,\n\t\t\t\trank: role.rank,\n\t\t\t\tmembers: []\n\t\t})\n\t\tlet next\n\t\tconst roleInfo = data.roles.find(r => r.id === role.id)\n\t\twhile (true) {\n\t\t\tlet link = groupURL + group.id + \"/roles/\" + role.id + \"/users?limit=100\"\n\t\t\tif (next) link += \"&cursor=\" + next\n\t\t\tconst data = await get(link)\n\t\t\tfor (const member of data.data) {\n\t\t\t\troleInfo?.members.push({\n\t\t\t\t\tid: member.userId,\n\t\t\t\t\tusername: member.username,\n\t\t\t\t})\n\t\t\t}\n\t\t\tnext = data.nextPageCursor\n\t\t\tif (next === null) break;\n\t\t}\n\t}\n\treturn data\n\t},\n\tdiff : async (first: Data, second: Data, options: Object = {}) => {\n\t\tconst diffData : diffData = {\n\t\t\tchanges : []\n\t\t}\n\t\tfor (const role1 of first.roles)\t{\n\t\t\tconst role2 = second.roles.find(r => r.id === role1.id)\n\t\t\tif (!role2) continue\n\t\t\t// Validate each member\n\t\t\tfor (const member of role1.members) {\n\t\t\t\tif (!role2.members.find(m => m.id === member.id)) {\n\t\t\t\t\t// try to find their old rank\n\t\t\t\t\tlet newRole : any = second.roles.find(r => r.members.find(m => m.id === member.id))\n\t\t\t\t\tif (newRole === undefined) {\n\t\t\t\t\t\tconst usersRoles = await get(`https://groups.roblox.com/v2/users/${member.id}/groups/roles`)\n\t\t\t\t\t\tconst groupInfo = usersRoles.data.find((r: any) => r.group.id === second.id)\n\t\t\t\t\t\tif (!groupInfo) {\n\t\t\t\t\t\t\tnewRole = {\n\t\t\t\t\t\t\t\tname: \"Guest\",\n\t\t\t\t\t\t\t\trank: 0\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewRole = {\n\t\t\t\t\t\t\t\tname: groupInfo.role.name,\n\t\t\t\t\t\t\t\trank: groupInfo.role.rank\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdiffData.changes.push({\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: member.id,\n\t\t\t\t\t\t\tusername: member.username,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toldRole: {\n\t\t\t\t\t\t\tname: role1.name,\n\t\t\t\t\t\t\trank: role1.rank,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnewRole: {\n\t\t\t\t\t\t\tname: newRole.name,\n\t\t\t\t\t\t\trank: newRole.rank,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tconsole.log(`${member.username} (${member.id}) was changed to ${newRole.name} from ${role1.name}`)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn diffData\n\t}\n}\n\n\nmodule.exports = RankTracker as RankTrackerType"],"mappings":"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","names":["data"]}